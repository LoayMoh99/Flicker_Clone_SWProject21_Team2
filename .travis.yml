sudo: required
language: generic

services:
  - docker


addons:
  ssh_known_hosts: 13.90.253.189

before_install:
  # Build Docker image for testing:
  - echo Build front and api docker images for testing..
  # - docker build -t loaymoh99/react-test -f ./front/Dockerfile.dev ./front
  # - docker build -t loaymoh99/nodejs-test -f ./api/Dockerfile.dev ./api

script:
  # Run tests with built Docker images:
  - echo Run react tests..
  #- docker run -e CI=true loaymoh99/react-test
  - echo Run nodejs tests...
  # - docker run -e CI=true loaymoh99/nodejs-test

after_success:
  - echo Building the production Docker image..
  - docker build -t loaymoh99/dkr-dropoids-front ./front
  - docker build -t loaymoh99/dkr-dropoids-nginx ./nginx
  - docker build -t loaymoh99/dkr-dropoids-api ./api
  # Log in to the docker CLI: loaymoh99/dkr-dropoids-front:$(date +%s)
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_ID" --password-stdin
  # Take those images and push them to docker hubgit push -u origin main:
  - echo Pushing the Docker images..
  - docker push loaymoh99/dkr-dropoids-front
  - docker push loaymoh99/dkr-dropoids-nginx
  - docker push loaymoh99/dkr-dropoids-api

before_deploy:


deploy:
  provider: script
  skip_cleanup: true
  script: bash ./.travis/deploy.sh
  on:
    branch: main
    #branch: devops # for testing locally only

# notifications:  
#   email:
#     recipients:
#       - loaymohamed1999@gmail.com
#     on_success: never # default: change
#     on_failure: always # default: always
